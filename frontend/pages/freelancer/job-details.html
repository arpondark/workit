<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                'inter': ['Inter', 'sans-serif'],
              },
              colors: {
                primary: {
                  DEFAULT: '#6366f1',
                  dark: '#4f46e5',
                  light: '#818cf8'
                },
                secondary: '#0ea5e9',
                success: '#22c55e',
                warning: '#f59e0b',
                danger: '#ef4444',
                dark: '#1e293b',
                gray: '#64748b',
                light: '#f8fafc'
              }
            }
          }
        }
      </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details - WorkIT</title>
    
    <link rel="stylesheet" href="../../css/styles.css">
    
</head>

<body class="bg-gray-50">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar"
            class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform z-50">
            <div class="flex flex-col h-full">
                <div class="p-6 border-b">
                    <a href="/" class="flex items-center">
                        <span
                            class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Work</span>
                        <span class="text-2xl font-bold text-gray-800">IT</span>
                    </a>
                </div>
                <nav class="flex-1 p-4 space-y-2">
                    <a href="dashboard.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                            </path>
                        </svg>
                        Dashboard
                    </a>
                    <a href="find-jobs.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg bg-indigo-50 text-indigo-600 font-medium">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                            </path>
                        </svg>
                        Find Jobs
                    </a>
                    <a href="my-applications.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        My Applications
                    </a>
                    <a href="active-jobs.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4">
                            </path>
                        </svg>
                        Active Jobs
                    </a>
                    <a href="../messages.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                            </path>
                        </svg>
                        Messages
                    </a>
                    <a href="earnings.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                            </path>
                        </svg>
                        Earnings
                    </a>
                    <a href="../profile.html"
                        class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-50 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Profile
                    </a>
                </nav>
                <div class="p-4 border-t">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center text-white font-semibold"
                            id="sidebar-avatar"></div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-gray-900 truncate" id="sidebar-name"></div>
                            <div class="text-sm text-gray-500">Freelancer</div>
                        </div>
                        <button id="logout-btn" class="text-gray-400 hover:text-red-500 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 lg:hidden hidden"></div>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-64">
            <header class="bg-white shadow-sm sticky top-0 z-30">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center gap-4">
                        <button id="menu-btn" class="lg:hidden text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <a href="find-jobs.html" class="text-gray-500 hover:text-indigo-600 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                        </a>
                        <h1 class="text-xl font-bold text-gray-900">Job Details</h1>
                    </div>
                </div>
            </header>

            <div class="p-6">
                <!-- Loading State -->
                <div id="loading-state" class="text-center py-12">
                    <div
                        class="loading-spinner w-12 h-12 mx-auto mb-4 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin">
                    </div>
                    <p class="text-gray-500">Loading job details...</p>
                </div>

                <!-- Error State -->
                <div id="error-state" class="hidden text-center py-12">
                    <svg class="w-16 h-16 text-red-300 mx-auto mb-4" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Job not found</h3>
                    <p class="text-gray-500 mb-4">The job you're looking for doesn't exist or has been removed.</p>
                    <a href="find-jobs.html" class="text-indigo-600 hover:text-indigo-700 font-medium">Browse all
                        jobs</a>
                </div>

                <!-- Job Details -->
                <div id="job-content" class="hidden">
                    <div class="grid lg:grid-cols-3 gap-6">
                        <!-- Main Content -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Job Header -->
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <div class="flex items-start justify-between gap-4 mb-4">
                                    <div>
                                        <h1 class="text-2xl font-bold text-gray-900" id="job-title"></h1>
                                        <p class="text-gray-500 mt-1" id="job-posted"></p>
                                    </div>
                                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium"
                                        id="job-status">Open</span>
                                </div>
                                <div class="flex flex-wrap gap-2" id="job-skills"></div>
                            </div>

                            <!-- Job Description -->
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h2 class="text-lg font-semibold text-gray-900 mb-4">Job Description</h2>
                                <div class="prose max-w-none text-gray-600" id="job-description"></div>
                            </div>

                            <!-- Requirements -->
                            <div class="bg-white rounded-xl shadow-sm p-6" id="requirements-section">
                                <h2 class="text-lg font-semibold text-gray-900 mb-4">Requirements</h2>
                                <ul class="list-disc list-inside space-y-2 text-gray-600" id="job-requirements"></ul>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <!-- Budget Card -->
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Budget</h3>
                                <div class="text-3xl font-bold text-indigo-600 mb-2" id="job-budget"></div>
                                <div class="text-sm text-gray-500" id="job-budget-type"></div>
                            </div>

                            <!-- Job Info -->
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Job Details</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-gray-500">Duration</div>
                                            <div class="font-medium text-gray-900" id="job-duration">Not specified</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z">
                                                </path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-gray-500">Experience Level</div>
                                            <div class="font-medium text-gray-900" id="job-experience">Not specified
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z">
                                                </path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-gray-500">Applications</div>
                                            <div class="font-medium text-gray-900" id="job-applications">0</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                                </path>
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="text-sm text-gray-500">Views</div>
                                            <div class="font-medium text-gray-900" id="job-views">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Client Info -->
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">About the Client</h3>
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xl font-bold"
                                        id="client-avatar"></div>
                                    <div>
                                        <div class="font-semibold text-gray-900" id="client-name"></div>
                                        <div class="text-sm text-gray-500" id="client-since"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Apply Button / Already Applied Status -->
                            <div id="apply-btn-container">
                                <button id="apply-btn"
                                    class="w-full bg-indigo-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">
                                    Apply Now
                                </button>
                            </div>
                            <div id="already-applied-container" class="hidden">
                                <div id="already-applied-badge"
                                    class="w-full py-4 rounded-xl font-semibold text-lg text-center border"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Apply Modal -->
    <div id="apply-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-900">Apply for Job</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <form id="apply-form" class="p-6">
                <input type="hidden" id="apply-job-id">

                <div class="mb-4">
                    <h4 class="font-semibold text-gray-900" id="modal-job-title"></h4>
                    <p class="text-gray-500 text-sm" id="modal-job-budget"></p>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Proposed Budget ($)</label>
                    <input type="number" id="proposed-budget" min="1" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        placeholder="Enter your proposed budget">
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Estimated Duration</label>
                    <select id="estimated-duration" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select duration</option>
                        <option value="Less than 1 week">Less than 1 week</option>
                        <option value="1-2 weeks">1-2 weeks</option>
                        <option value="2-4 weeks">2-4 weeks</option>
                        <option value="1-2 months">1-2 months</option>
                        <option value="2-3 months">2-3 months</option>
                        <option value="3-6 months">3-6 months</option>
                        <option value="More than 6 months">More than 6 months</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cover Letter</label>
                    <textarea id="cover-letter" rows="5" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"
                        placeholder="Explain why you're the best fit for this job..."></textarea>
                    <p class="text-sm text-gray-500 mt-1">Minimum 50 characters</p>
                </div>

                <div class="flex gap-3">
                    <button type="button" id="cancel-apply"
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button type="submit" id="submit-apply"
                        class="flex-1 px-4 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition">
                        Submit Application
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="../../js/utils.js"></script>
    <script>
        // Check authentication
        if (!auth.isLoggedIn() || auth.getUser().role !== 'freelancer') {
            window.location.href = '/pages/auth/login.html';
        }

        const user = auth.getUser();
        document.getElementById('sidebar-avatar').textContent = utils.getInitials(user.name);
        document.getElementById('sidebar-name').textContent = user.name;

        // Mobile menu
        document.getElementById('menu-btn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('-translate-x-full');
            document.getElementById('sidebar-overlay').classList.remove('hidden');
        });
        document.getElementById('sidebar-overlay').addEventListener('click', () => {
            document.getElementById('sidebar').classList.add('-translate-x-full');
            document.getElementById('sidebar-overlay').classList.add('hidden');
        });
        document.getElementById('logout-btn').addEventListener('click', () => auth.logout());

        let jobData = null;
        let userApplication = null; // Track if user already applied

        // Load job details
        async function loadJobDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('id');

            if (!jobId) {
                showError();
                return;
            }

            try {
                const response = await api.get(`/jobs/${jobId}`);
                jobData = response.job;

                // Check if user already applied to this job
                try {
                    const appsData = await api.get('/applications/freelancer/my-applications?limit=100');
                    const applications = appsData.data || [];
                    userApplication = applications.find(app => app.job?._id === jobId);
                } catch (err) {
                    console.log('Could not check application status');
                }

                renderJobDetails(jobData);
            } catch (error) {
                console.error('Error loading job:', error);
                showError();
            }
        }

        function showError() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('error-state').classList.remove('hidden');
        }

        function renderJobDetails(job) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('job-content').classList.remove('hidden');

            // Job header
            document.getElementById('job-title').textContent = job.title;
            document.getElementById('job-posted').textContent = `Posted ${utils.timeAgo(job.createdAt)}`;
            document.getElementById('job-status').textContent = job.status === 'open' ? 'Open' : job.status.charAt(0).toUpperCase() + job.status.slice(1);

            // Status badge color
            const statusBadge = document.getElementById('job-status');
            if (job.status !== 'open') {
                statusBadge.className = 'px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium';
            }

            // Skills
            const skillsContainer = document.getElementById('job-skills');
            if (job.skill) {
                skillsContainer.innerHTML = `<span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm">${job.skill.name || job.skill}</span>`;
            }

            // Description
            document.getElementById('job-description').innerHTML = job.description.replace(/\n/g, '<br>');

            // Requirements
            const reqSection = document.getElementById('requirements-section');
            const reqList = document.getElementById('job-requirements');
            if (job.requirements && job.requirements.length > 0) {
                reqList.innerHTML = job.requirements.map(req => `<li>${req}</li>`).join('');
            } else {
                reqSection.classList.add('hidden');
            }

            // Budget
            const budgetText = job.budget?.type === 'fixed'
                ? `$${job.budget.min}`
                : `$${job.budget?.min || 0} - $${job.budget?.max || 0}`;
            document.getElementById('job-budget').textContent = budgetText;
            document.getElementById('job-budget-type').textContent = job.budget?.type === 'fixed' ? 'Fixed Price' : 'Hourly Rate';

            // Job details
            document.getElementById('job-duration').textContent = job.duration || 'Not specified';
            document.getElementById('job-experience').textContent = job.experienceLevel ?
                job.experienceLevel.charAt(0).toUpperCase() + job.experienceLevel.slice(1) : 'Any level';
            document.getElementById('job-applications').textContent = job.applicationsCount || 0;
            document.getElementById('job-views').textContent = job.views || 0;

            // Client info
            document.getElementById('client-avatar').textContent = utils.getInitials(job.client?.name || 'C');
            document.getElementById('client-name').textContent = job.client?.name || 'Client';
            document.getElementById('client-since').textContent = job.client?.createdAt ?
                `Member since ${new Date(job.client.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}` : '';

            // Update page title
            document.title = `${job.title} - WorkIT`;

            // Hide apply button if job is not open
            if (job.status !== 'open') {
                document.getElementById('apply-btn-container').classList.add('hidden');
            }

            // Check if user already applied
            if (userApplication) {
                document.getElementById('apply-btn-container').classList.add('hidden');
                document.getElementById('already-applied-container').classList.remove('hidden');

                const statusColors = {
                    'pending': 'bg-yellow-100 text-yellow-700 border-yellow-200',
                    'accepted': 'bg-green-100 text-green-700 border-green-200',
                    'rejected': 'bg-red-100 text-red-700 border-red-200',
                    'shortlisted': 'bg-blue-100 text-blue-700 border-blue-200'
                };
                const statusClass = statusColors[userApplication.status] || 'bg-gray-100 text-gray-700 border-gray-200';
                const statusText = userApplication.status.charAt(0).toUpperCase() + userApplication.status.slice(1);

                const badge = document.getElementById('already-applied-badge');
                badge.className = `w-full py-4 rounded-xl font-semibold text-lg text-center border flex items-center justify-center gap-2 ${statusClass}`;
                badge.innerHTML = `
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Already Applied \u2022 ${statusText}
                `;
            }
        }

        // Apply modal
        function openApplyModal() {
            if (!jobData) return;

            document.getElementById('apply-job-id').value = jobData._id;
            document.getElementById('modal-job-title').textContent = jobData.title;
            const budgetText = jobData.budget?.type === 'fixed'
                ? `$${jobData.budget.min} Fixed`
                : `$${jobData.budget?.min || 0} - $${jobData.budget?.max || 0}/hr`;
            document.getElementById('modal-job-budget').textContent = budgetText;
            document.getElementById('proposed-budget').value = '';
            document.getElementById('estimated-duration').value = '';
            document.getElementById('cover-letter').value = '';
            document.getElementById('apply-modal').classList.remove('hidden');
        }

        function closeApplyModal() {
            document.getElementById('apply-modal').classList.add('hidden');
        }

        document.getElementById('apply-btn').addEventListener('click', openApplyModal);
        document.getElementById('close-modal').addEventListener('click', closeApplyModal);
        document.getElementById('cancel-apply').addEventListener('click', closeApplyModal);

        document.getElementById('apply-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const jobId = document.getElementById('apply-job-id').value;
            const proposedBudget = parseFloat(document.getElementById('proposed-budget').value);
            const estimatedDuration = document.getElementById('estimated-duration').value;
            const coverLetter = document.getElementById('cover-letter').value.trim();

            if (!proposedBudget || proposedBudget < 1) {
                toast.error('Please enter a valid proposed budget');
                return;
            }

            if (!estimatedDuration) {
                toast.error('Please select an estimated duration');
                return;
            }

            if (coverLetter.length < 50) {
                toast.error('Cover letter must be at least 50 characters');
                return;
            }

            const submitBtn = document.getElementById('submit-apply');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                await api.post(`/applications/${jobId}`, {
                    proposedBudget,
                    estimatedDuration,
                    coverLetter
                });

                toast.success('Application submitted successfully!');
                closeApplyModal();

                // Redirect to my applications page
                setTimeout(() => {
                    window.location.href = 'my-applications.html';
                }, 1500);
            } catch (error) {
                if (error.data && error.data.requireSkillTest) {
                    modal.show({
                        title: 'Skill Verification Required',
                        content: `<p class="mb-4">${error.message}</p><p class="text-sm text-gray-500">Passing this test will verify your expertise and allow you to apply for this job.</p>`,
                        confirmText: 'Take Skill Test',
                        cancelText: 'Later',
                        onConfirm: () => {
                            window.location.href = `/pages/auth/quiz.html?skill=${error.data.skillId}`;
                        }
                    });
                } else {
                    toast.error(error.message || 'Failed to submit application');
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Application';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadJobDetails);
    </script>
</body>

</html>